<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-50700-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {dataLayer.push(arguments); }
    gtag("js", new Date());

    gtag("config", "UA-50700-3");
 </script><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Collecting pictures using Instagram API</title><meta name="description" content="{formatter.body}"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/c5845997dbbd64838899.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c5845997dbbd64838899.css"/><link rel="preload" href="/_next/static/chunks/main-bf62e0ed315519322e77.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" as="script"/><link rel="preload" href="/_next/static/chunks/c332eec026863555a27dac51ec167aa1a0b2daea.616ccd5db4903f86882e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-8666f5765e088cb4bc64.js" as="script"/><link rel="preload" href="/_next/static/chunks/447cfa7d44c888c772d6119f6f6093046de0bb36.0102901cd8c2b2b44f0d.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bpostname%5D-ce3fa2cc3073b5f890d3.js" as="script"/></head><body><div id="__next"><a href="/blog/">Back to post list</a><article><h1>Collecting pictures using Instagram API</h1><div><pre><code>    </code></pre><p>Instagram has an API. That’s good. But its document was a little bit confusing to me. This is how I ended up implementing Perl code that populates Instagram pictures that have a hashtag of my interest.</p><h2>First confusion - is authentication required or not?</h2><p>To get information of pictures with a hashtag, Instagram API offers “Tag” endpoints. <a href="http://instagram.com/developer/endpoints/tags/">The document about Tag endpoint</a>s says though it requires authentication, thus requires access<!-- -->_<!-- -->token parameter. But wait, whose access<!-- -->_<!-- -->token does it require, when all I want is information about publicly viewable photos with a hashtag?</p><p>I thought it didn’t make sense to give my own access<!-- -->_<!-- -->token that does work on behalf of my own user account. Or any user account. My intention was to implement a backend service that works periodically to collect pictures with certain hashtags. I just ignored the document and just gave my app’s client<!-- -->_<!-- -->id that I generated on Instagram console. As expected, it worked.</p><h3>Point #1: you probably don’t need access<!-- -->_<!-- -->token and all of those pita steps to get OAuth2 access token from a user account.</h3><h2>Second confusion: how do I paginate the results to get more results?</h2><p>Twitter API does a great job by offering since<!-- -->_<!-- -->id and max<!-- -->_<!-- -->id parameters, so we as a client developer doesn’t have to consider duplicated tweets from two result sets from API calls. <a href="https://dev.twitter.com/docs/working-with-timelines">Twitter documentation about “Working with Timelines”</a> is really well written and easy to understand what we should do.</p><p>Since Instagram offers same type of data that is a stream of posts ordered by pictures posted descending, it has similar pagination parameters; it is only more confusing.</p><p>Instagram API names those paramters as max<!-- -->_<!-- -->tag<!-- -->_<!-- -->id and min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id. <a href="http://instagram.com/developer/endpoints/#pagination">Instagram API also returns “pagination” meta data</a> in API results, which has “next<!-- -->_<!-- -->url” value which looks something like this</p><p><a href="https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx&amp;max_tag_id=1391400658711">https://api.instagram.com/v1/tags/puppy/media/recent?client<!-- -->_<!-- -->id=xxx&amp;max<!-- -->_<!-- -->tag<!-- -->_<!-- -->id=1391400658711</a></p><p>It also carries two more important values</p><p>{<br/>&quot;next<!-- -->_<!-- -->max<!-- -->_<!-- -->tag<!-- -->_<!-- -->id&quot;:&quot;1391400658711&quot;,<br/>&quot;min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id&quot;:&quot;1391400689156&quot;<br/>}</p><p>Calling the API by using the next<!-- -->_<!-- -->url value (note that it has the same id as next<!-- -->_<!-- -->max<!-- -->_<!-- -->tag<!-- -->_<!-- -->id has) returns the next set of results which carries the newest pictures whose id is less than max<!-- -->_<!-- -->tag<!-- -->_<!-- -->id.</p><p>As my goal is to get pictures periodically, storing next<!-- -->_<!-- -->max<!-- -->_<!-- -->tag<!-- -->_<!-- -->id for the next iteration doesn’t make sense because specifying that value narrows down the results to something that I always have collected.</p><p>So, I rather stored min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id and called the API next time with something like </p><p><a href="https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx&amp;min_tag_id=1391400658711">https://api.instagram.com/v1/tags/puppy/media/recent?client<!-- -->_<!-- -->id=xxx&amp;min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id=1391400658711</a></p><p>Unfortunately, this returned nothing. It was obvious after a few more experiments and scratching my head, that because what I wanted was pictures posted after the biggest id, but Instagram calls it “min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id”! Instagram calls it small ids as “max”, or “next” when in fact it is actually about getting older data, instead of new data that I assumed.</p><p>So the final code of mine stores the “min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id” in the database for the next iteration, and calls the API with min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id=&lt;stored min<!-- -->_<!-- -->tag<!-- -->_<!-- -->id&gt;, to avoid getting data that is already in our database.</p><h3>Point #2: “max” and “next” could mean different things to different heads.</h3><p>In my humble opinion though, Twitter API does smarter job here as it called those parameters as since<!-- -->_<!-- -->id and max<!-- -->_<!-- -->id, less confusing at least to me.</p></div></article></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"slug":"/blog/collecting-pictures-using-instagram-api","date":"Sun, 02 Feb 2014 20:33:00 GMT","title":"Collecting pictures using Instagram API","epoch":"1391373180"},"markdownBody":"        \nInstagram has an API. That’s good. But its document was a little bit confusing to me. This is how I ended up implementing Perl code that populates Instagram pictures that have a hashtag of my interest.\n\nFirst confusion - is authentication required or not?\n----------------------------------------------------\n\nTo get information of pictures with a hashtag, Instagram API offers “Tag” endpoints. [The document about Tag endpoint](http://instagram.com/developer/endpoints/tags/)s says though it requires authentication, thus requires access\\_token parameter. But wait, whose access\\_token does it require, when all I want is information about publicly viewable photos with a hashtag?\n\nI thought it didn’t make sense to give my own access\\_token that does work on behalf of my own user account. Or any user account. My intention was to implement a backend service that works periodically to collect pictures with certain hashtags. I just ignored the document and just gave my app’s client\\_id that I generated on Instagram console. As expected, it worked.\n\n### Point #1: you probably don’t need access\\_token and all of those pita steps to get OAuth2 access token from a user account.\n\nSecond confusion: how do I paginate the results to get more results?\n--------------------------------------------------------------------\n\nTwitter API does a great job by offering since\\_id and max\\_id parameters, so we as a client developer doesn’t have to consider duplicated tweets from two result sets from API calls. [Twitter documentation about “Working with Timelines”](https://dev.twitter.com/docs/working-with-timelines) is really well written and easy to understand what we should do.\n\nSince Instagram offers same type of data that is a stream of posts ordered by pictures posted descending, it has similar pagination parameters; it is only more confusing.\n\nInstagram API names those paramters as max\\_tag\\_id and min\\_tag\\_id. [Instagram API also returns “pagination” meta data](http://instagram.com/developer/endpoints/#pagination) in API results, which has “next\\_url” value which looks something like this\n\n[https://api.instagram.com/v1/tags/puppy/media/recent?client\\_id=xxx\u0026max\\_tag\\_id=1391400658711](https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx\u0026max_tag_id=1391400658711)\n\nIt also carries two more important values\n\n{  \n\"next\\_max\\_tag\\_id\":\"1391400658711\",  \n\"min\\_tag\\_id\":\"1391400689156\"  \n}\n\nCalling the API by using the next\\_url value (note that it has the same id as next\\_max\\_tag\\_id has) returns the next set of results which carries the newest pictures whose id is less than max\\_tag\\_id.\n\nAs my goal is to get pictures periodically, storing next\\_max\\_tag\\_id for the next iteration doesn’t make sense because specifying that value narrows down the results to something that I always have collected.\n\nSo, I rather stored min\\_tag\\_id and called the API next time with something like \n\n[https://api.instagram.com/v1/tags/puppy/media/recent?client\\_id=xxx\u0026min\\_tag\\_id=1391400658711](https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx\u0026min_tag_id=1391400658711)\n\nUnfortunately, this returned nothing. It was obvious after a few more experiments and scratching my head, that because what I wanted was pictures posted after the biggest id, but Instagram calls it “min\\_tag\\_id”! Instagram calls it small ids as “max”, or “next” when in fact it is actually about getting older data, instead of new data that I assumed.\n\nSo the final code of mine stores the “min\\_tag\\_id” in the database for the next iteration, and calls the API with min\\_tag\\_id=\u003cstored min\\_tag\\_id\u003e, to avoid getting data that is already in our database.\n\n### Point #2: “max” and “next” could mean different things to different heads.\n\nIn my humble opinion though, Twitter API does smarter job here as it called those parameters as since\\_id and max\\_id, less confusing at least to me.\n\n"},"__N_SSG":true},"page":"/blog/[postname]","query":{"postname":"collecting-pictures-using-instagram-api"},"buildId":"N_aBrV0MXwX8QwoUPSB1n","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9a32872f6a983227f3b1.js"></script><script src="/_next/static/chunks/main-bf62e0ed315519322e77.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" async=""></script><script src="/_next/static/chunks/c332eec026863555a27dac51ec167aa1a0b2daea.616ccd5db4903f86882e.js" async=""></script><script src="/_next/static/chunks/pages/_app-8666f5765e088cb4bc64.js" async=""></script><script src="/_next/static/chunks/447cfa7d44c888c772d6119f6f6093046de0bb36.0102901cd8c2b2b44f0d.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bpostname%5D-ce3fa2cc3073b5f890d3.js" async=""></script><script src="/_next/static/N_aBrV0MXwX8QwoUPSB1n/_buildManifest.js" async=""></script><script src="/_next/static/N_aBrV0MXwX8QwoUPSB1n/_ssgManifest.js" async=""></script></body></html>