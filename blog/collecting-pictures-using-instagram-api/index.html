<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-50700-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {dataLayer.push(arguments); }
    gtag("js", new Date());

    gtag("config", "UA-50700-3");
 </script><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&amp;display=swap"/><link rel="alternate" type="application/atom+xml" title="Atom feed for blog by Fumiaki Yoshimatsu" href="https://luckypines.com/feed.atom"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Collecting pictures using Instagram API</title><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fumiakiy"/><meta name="og:title" content="Collecting pictures using Instagram API"/><meta name="twitter:title" content="Collecting pictures using Instagram API"/><link rel="prev" href="https://luckypines.com/blog/migrating-google-login-from-openid-20-to-google-3"/><link rel="next" href="https://luckypines.com/blog/david-heinemeier-hansson-at-startup-school-2008"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/6de6ddfed9db1c7fb4ee.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6de6ddfed9db1c7fb4ee.css" data-n-g=""/><link rel="preload" href="/_next/static/css/29322049ad2d64914a28.css" as="style"/><link rel="stylesheet" href="/_next/static/css/29322049ad2d64914a28.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-ea5363f7b1817a1ef87a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-433e55c570e54029027f.js" defer=""></script><script src="/_next/static/chunks/447-c4b6ab018540e23a2fac.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpostname%5D-63ae8f4d167167c4674b.js" defer=""></script><script src="/_next/static/nVICeFtCkD4tmdHb-tkPj/_buildManifest.js" defer=""></script><script src="/_next/static/nVICeFtCkD4tmdHb-tkPj/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap">@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_7PqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_Of2PQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSV0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSx0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSt0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSd0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSZ0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSh0me8iUI0.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSV0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSx0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSt0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSd0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSZ0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSh0me8iUI0.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSV0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSx0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSt0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSd0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSZ0me8iUI0lkQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xTDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vrtSM1J-gEPT5Ese6hmHSh0me8iUI0.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="blog"><article class="BlogPost_article__3W1r-"><h1>Collecting pictures using Instagram API</h1><div>2/2/2014, 3:33:00 PM</div><div class="BlogPost_body__1oPZH"><div>Instagram has an API. That’s good. But its document was a little bit confusing to me. This is how I ended up implementing Perl code that populates Instagram pictures that have a hashtag of my interest.</div>
<h2>First confusion - is authentication required or not?</h2>
<div>To get information of pictures with a hashtag, Instagram API offers “Tag” endpoints. <a href="http://instagram.com/developer/endpoints/tags/">The document about Tag endpoint</a>s says though it requires authentication, thus requires access_token parameter. But wait, whose access_token does it require, when all I want is information about publicly viewable photos with a hashtag?</div>
<div>I thought it didn’t make sense to give my own access_token that does work on behalf of my own user account. Or any user account. My intention was to implement a backend service that works periodically to collect pictures with certain hashtags. I just ignored the document and just gave my app’s client_id that I generated on Instagram console. As expected, it worked.</div>
<h3>Point #1: you probably don’t need access_token and all of those pita steps to get OAuth2 access token from a user account.</h3>
<h2>Second confusion: how do I paginate the results to get more results?</h2>
<div>Twitter API does a great job by offering since_id and max_id parameters, so we as a client developer doesn’t have to consider duplicated tweets from two result sets from API calls. <a href="https://dev.twitter.com/docs/working-with-timelines">Twitter documentation about “Working with Timelines”</a> is really well written and easy to understand what we should do.</div>
<div>Since Instagram offers same type of data that is a stream of posts ordered by pictures posted descending, it has similar pagination parameters; it is only more confusing.</div>
<div>Instagram API names those paramters as max_tag_id and min_tag_id. <a href="http://instagram.com/developer/endpoints/#pagination">Instagram API also returns “pagination” meta data</a> in API results, which has “next_url” value which looks something like this</div>
<div><a href="https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx&amp;max_tag_id=1391400658711">https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx&amp;max_tag_id=1391400658711</a></div>
<div>It also carries two more important values</div>
<pre><code>{  
    &quot;next_max_tag_id&quot;:&quot;1391400658711&quot;,  
    &quot;min_tag_id&quot;:&quot;1391400689156&quot;  
}
</code></pre>
<div>Calling the API by using the next_url value (note that it has the same id as next_max_tag_id has) returns the next set of results which carries the newest pictures whose id is less than max_tag_id.</div>
<div>As my goal is to get pictures periodically, storing next_max_tag_id for the next iteration doesn’t make sense because specifying that value narrows down the results to something that I always have collected.</div>
<div>So, I rather stored min_tag_id and called the API next time with something like </div>
<div><a href="https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx&amp;min_tag_id=1391400658711">https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx&amp;min_tag_id=1391400658711</a></div>
<div>Unfortunately, this returned nothing. It was obvious after a few more experiments and scratching my head, that because what I wanted was pictures posted after the biggest id, but Instagram calls it “min_tag_id”! Instagram calls it small ids as “max”, or “next” when in fact it is actually about getting older data, instead of new data that I assumed.</div>
<div>So the final code of mine stores the “min_tag_id” in the database for the next iteration, and calls the API with min_tag_id=<!-- -->&lt;stored min_tag_id&gt;<!-- -->, to avoid getting data that is already in our database.</div>
<h3>Point #2: “max” and “next” could mean different things to different heads.</h3>
<div>In my humble opinion though, Twitter API does smarter job here as it called those parameters as since_id and max_id, less confusing at least to me.</div></div></article></div><footer class="BlogPost_footer__YgPcw"><a class="BlogPost_prev__2S7U6" href="/blog/migrating-google-login-from-openid-20-to-google-3/">« <!-- -->Migrating Google login from OpenID 2.0 to Google+ (Part 3 of 3)</a><a href="/blog/">Blog</a><a class="BlogPost_next__1yyYz" href="/blog/david-heinemeier-hansson-at-startup-school-2008/">David Heinemeier Hansson at Startup School 2008<!-- --> » </a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"slug":"/blog/collecting-pictures-using-instagram-api","date":"Sun, 02 Feb 2014 20:33:00 GMT","title":"Collecting pictures using Instagram API","epoch":"1391373180"},"markdownBody":"\n\nInstagram has an API. That’s good. But its document was a little bit confusing to me. This is how I ended up implementing Perl code that populates Instagram pictures that have a hashtag of my interest.\n\nFirst confusion - is authentication required or not?\n----------------------------------------------------\n\nTo get information of pictures with a hashtag, Instagram API offers “Tag” endpoints. [The document about Tag endpoint](http://instagram.com/developer/endpoints/tags/)s says though it requires authentication, thus requires access_token parameter. But wait, whose access_token does it require, when all I want is information about publicly viewable photos with a hashtag?\n\nI thought it didn’t make sense to give my own access_token that does work on behalf of my own user account. Or any user account. My intention was to implement a backend service that works periodically to collect pictures with certain hashtags. I just ignored the document and just gave my app’s client_id that I generated on Instagram console. As expected, it worked.\n\n### Point #1: you probably don’t need access_token and all of those pita steps to get OAuth2 access token from a user account.\n\nSecond confusion: how do I paginate the results to get more results?\n--------------------------------------------------------------------\n\nTwitter API does a great job by offering since_id and max_id parameters, so we as a client developer doesn’t have to consider duplicated tweets from two result sets from API calls. [Twitter documentation about “Working with Timelines”](https://dev.twitter.com/docs/working-with-timelines) is really well written and easy to understand what we should do.\n\nSince Instagram offers same type of data that is a stream of posts ordered by pictures posted descending, it has similar pagination parameters; it is only more confusing.\n\nInstagram API names those paramters as max_tag_id and min_tag_id. [Instagram API also returns “pagination” meta data](http://instagram.com/developer/endpoints/#pagination) in API results, which has “next_url” value which looks something like this\n\n[https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx\u0026max_tag_id=1391400658711](https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx\u0026max_tag_id=1391400658711)\n\nIt also carries two more important values\n\n```\n{  \n    \"next_max_tag_id\":\"1391400658711\",  \n    \"min_tag_id\":\"1391400689156\"  \n}\n```\n\nCalling the API by using the next_url value (note that it has the same id as next_max_tag_id has) returns the next set of results which carries the newest pictures whose id is less than max_tag_id.\n\nAs my goal is to get pictures periodically, storing next_max_tag_id for the next iteration doesn’t make sense because specifying that value narrows down the results to something that I always have collected.\n\nSo, I rather stored min_tag_id and called the API next time with something like \n\n[https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx\u0026min_tag_id=1391400658711](https://api.instagram.com/v1/tags/puppy/media/recent?client_id=xxx\u0026min_tag_id=1391400658711)\n\nUnfortunately, this returned nothing. It was obvious after a few more experiments and scratching my head, that because what I wanted was pictures posted after the biggest id, but Instagram calls it “min_tag_id”! Instagram calls it small ids as “max”, or “next” when in fact it is actually about getting older data, instead of new data that I assumed.\n\nSo the final code of mine stores the “min_tag_id” in the database for the next iteration, and calls the API with min_tag_id=\u003cstored min_tag_id\u003e, to avoid getting data that is already in our database.\n\n### Point #2: “max” and “next” could mean different things to different heads.\n\nIn my humble opinion though, Twitter API does smarter job here as it called those parameters as since_id and max_id, less confusing at least to me.\n\n","navs":{"nextPage":{"epoch":"1391634060","title":"David Heinemeier Hansson at Startup School 2008","slug":"/blog/david-heinemeier-hansson-at-startup-school-2008"},"prevPage":{"epoch":"1390759380","title":"Migrating Google login from OpenID 2.0 to Google+ (Part 3 of 3)","slug":"/blog/migrating-google-login-from-openid-20-to-google-3"}}},"__N_SSG":true},"page":"/blog/[postname]","query":{"postname":"collecting-pictures-using-instagram-api"},"buildId":"nVICeFtCkD4tmdHb-tkPj","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>